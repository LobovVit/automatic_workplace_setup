# ADR-001 — Форм-фактор мастера автонастройки и схема доставки пользователю

## Статус
Accepted

## Контекст

Для настройки АРМ пользователей ЛК ГИИС ЭБ требуется:

- доступ к локальным криптопровайдерам (CryptoPro, корневые/личные сертификаты);
- установка драйверов (Rutoken);
- проверка конкурирующих TLS-клиентов;
- исправление настроек реестра/браузера;
- локальный аудит конфигурации ПК.

Веб-приложение (в браузере) не может:

- устанавливать ПО в Windows/Linux,
- устанавливать корневые сертификаты,
- управлять CryptoPro CSP/Plugin,
- работать с носителем Rutoken,
- вносить изменения в системные настройки.

Также браузер работает в песочнице → доступ к криптографии ограничен.

## Решение

### 1. Мастер автонастройки реализуется как **Desktop-приложение**

Форм-фактор:

- для Windows → `.exe`
- для Linux → `.AppImage` или `.tar.gz` (в зависимости от сборки)

### 2. Технологии мастера

- **C#**
- **.NET 8+**
- **Avalonia UI**
- **XAML**
- **парадигма MVVM**

Это обеспечивает:

- единый код под Windows и Linux;
- современный, отзывчивый UI;
- удобную структуру View → ViewModel → Model → Controls.

### 3. Доставка мастера пользователю

Мастер скачивается через портал, реализованный на:

- **CMS Grav Master** (редактирование контента)
- **CMS Grav Slave 1 и 2** (отдача пользователям)
- **Nginx reverse proxy**
- **Load Balancer**

Цепочка:
User → Load Balancer → NginxX → GravSlaveX → *.exe / *.AppImage
Файлы хранятся **только в Grav Master** и автоматически реплицируются в оба Slave.

### 4. Запуск мастера

После скачивания мастер:

- запускается **локально на ПК**;
- не имеет сетевых зависимостей;
- работает полностью в офлайн-режиме.

## Последствия

### Положительные
- Мастер доступен пользователям любых ОС (Windows/Linux).
- Доступ к криптографии и драйверам — без ограничений браузера.
- Минимальная нагрузка на портал: Grav раздаёт статические файлы.
- Полная автономность: мастер работает без сервера.

### Отрицательные
- Требуется ручная загрузка EXE/AppImage.
- Некоторые организации ограничивают запуск EXE-файлов (решается инструкцией).