# ADR-005 — Использование CMS Grav (Master/Slave) без выделенного backend и с двумя независимыми slave-узлами

## Статус
Accepted

## Контекст

Для портала помощи пользователям ЛК ГИИС ЭБ требуются:

- отображение новостей и аварийных сообщений;
- предоставление файлов мастеров (Windows/Linux);
- предоставление сертификатов, инструкций и сопутствующих материалов;
- минимизация сложности и количества компонентов;
- возможность редактирования контента силами администраторов ФК;
- высокая отказоустойчивость и масштабируемость;
- отсутствие backend-приложения (в проекте нет REST API, бизнес-логика находится в мастерах).

Ранее рассматривались варианты:

- SPA + backend,
- Nginx + статические HTML,
- CMS Grav с одним slave.

Проведённый анализ показал, что размещение контента в CMS Grav оптимально, но один slave создаёт SPOF и увеличивает нагрузку.

## Решение

Принято решение построить веб-часть следующим образом:

### 1. CMS Grav Master

- единственный узел, доступный **только из локальной сети ФК**;
- используется для редактирования новостей, аварий, сертификатов, инструкций;
- используется для загрузки EXE/AppImage файлов мастеров;
- выполняет синхронизацию на оба slave.

### 2. CMS Grav Slave #1 и #2

- два независимых read-only узла;
- каждый используется соответствующим Nginx:
  LB → Nginx1 → GravSlave1
  LB → Nginx2 → GravSlave2
- отказ одного из slave или nginx не влияет на доступность портала;
- пользователи получают контент с ближнего и доступного slave.

### 3. Процесс синхронизации

Grav Master реплицирует контент в оба slave:

- rsync,
- Git mirror,
- CI/CD pipeline,
- либо штатные плагины Grav (решается эксплуатацией).

### 4. Никакого backend API

Проект не содержит:

- выделенного backend-приложения,
- REST API,
- микросервисов.

Все данные отдаются статически через Grav.

Файл мастера скачивается пользователем напрямую:
User → LB → NginxX → GravSlaveX → EXE/AppImage
Дальнейшая работа мастера выполняется **локально на ПК** и не зависит от портала.

### 5. Мастер Windows/Linux как отдельный контейнер

Связь пользователя:
User → GravSlaveX (скачивание)
User → Master (локальная работа)
Мастер не общается с Grav после скачивания.

## Последствия

### Положительные

- Упрощение архитектуры, минимальные зависимости.
- Высокая отказоустойчивость благодаря двум slave.
- Уменьшение нагрузки: каждый Nginx обслуживает свой backend.
- Простота масштабирования (добавление новых slave).
- Удобное управление контентом через Grav Master.
- Меньше точек отказа, чем при классическом SPA/backend.

### Отрицательные

- Контент редактируется вручную (новости, аварии, статусы подсистем).
- Не подходит для динамических API-запросов (но они не требуются).

## Статус решения

Подтверждено архитектурной группой. Используется как основа всей серверной части.