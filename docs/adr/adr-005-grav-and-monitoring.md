# ADR-005: Выбор CMS Grav и модель мониторинга веб-части

## Контекст

Для веб-интерфейса подсистемы автонастройки АРМ требуется CMS, которая:

- не требует отдельной СУБД (минимум инфраструктурных зависимостей);
- легко интегрируется в существующую инфраструктуру ФК (Nginx, PHP);
- имеет локальную админку, доступную только внутри сети ФК;
- позволяет управлять файлами:
    - дистрибутивы CryptoPro (CSP, плагин),
    - корневые и промежуточные сертификаты,
    - дистрибутивы Настройщика АРМ (Windows / Linux),
    - текстовая инструкция по ручной настройке;
- позволяет оперативно публиковать аварийные сообщения и новости
  на странице входа/помощи.

Также требуется стандартная модель мониторинга веб-части, совместимая
с используемой в ФК системой (Nginx → Elastic → Kibana).

## Решение

В качестве CMS для веб-части выбрана **Grav**:

- CMS на PHP с файловой моделью хранения (без СУБД);
- развёртывается на связке **Nginx + PHP-FPM** в инфраструктуре ФК;
- админ-панель доступна только из **локальной сети ФК** (ограничение по сети / firewall);
- использует **локальную авторизацию** (встроенные механизмы Grav);
- через админку осуществляется управление:
    - контентом страниц (блоки «Вход», «Авария», «Помощь», «Новости»),
    - файлами дистрибутивов CryptoPro,
    - корневыми/промежуточными сертификатами,
    - файлами мастера автонастройки (Windows / Linux),
    - текстовыми инструкциями.

В C4 Level 2 CMS Grav моделируется как отдельный контейнер:

- `CMS Grav (PHP)` — поставщик контента и файлов для веб-страницы входа,
- `Администратор ФК` — актор, работающий с админкой Grav в локальной сети.

## Мониторинг и метрики

Принят подход: **метрики фиксируются на уровне логов веб-сервера (Nginx)**,
а далее собираются и визуализируются существующими средствами мониторинга ФК.

Основные метрики:

- доступность веб-страницы (HTTP-коды, время ответа);
- количество скачиваний файлов Настройщика АРМ
  (анализ путей скачивания в access-log);
- ошибки и аномалии (4xx, 5xx);
- попытки перехода в ЛК ЭБ по кнопке «Приступить к работе»
  (метрика уточняется, фиксируется по соответствующему URL/endpoint).

Технологический стек мониторинга:

- Nginx пишет логи `access.log` и `error.log`;
- логи читаются агентом (Filebeat/Logstash или аналог);
- данные загружаются в **Elasticsearch**;
- дашборды строятся в **Kibana**:
    - доступность веб-части,
    - количество скачиваний Настройщика,
    - динамика обращений,
    - распределение ошибок.

## Последствия

### Положительные

- Простая эксплуатация:
    - нет отдельной СУБД, файловая CMS;
    - минимум инфраструктурных зависимостей.
- Полный контроль над контентом и файлами через админку Grav.
- Чёткое разделение:
    - веб-страница входа (HTML/JS),
    - CMS Grav (управление контентом),
    - backend/API (опциональный).
- Единая стандартная модель мониторинга (Nginx → Elastic → Kibana),
  согласованная с практиками ФК.

### Отрицательные / ограничения

- Grav не предназначен для сложной бизнес-логики и тяжёлых транзакционных сценариев (в рамках текущей подсистемы это не требуется).
- Необходимость администрирования CMS (регулярные бэкапы, обновления плагинов/ядра Grav).
- Требуется чёткая настройка сети и прав доступа к админке (только локальная сеть ФК).