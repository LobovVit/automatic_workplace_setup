# ADR-003: Локальное выполнение мастера и политика логирования/отчётности

- **Статус:** принят/не принят
- **Дата:** 2025-11-20

## Контекст

Мастер автонастройки:
- работает с чувствительными объектами: личные сертификаты, ключевые контейнеры, системные настройки и т.д.;
- должен соответствовать требованиям ИБ и не допускать утечки информации;
- при этом требуется возможность диагностировать проблемы (логи/отчёты для службы поддержки и администраторов).

Возникает вопрос:
- где выполняется логика и где хранятся данные проверки;
- отправляются ли логи куда-то наружу.

## Решение

Принято решение:

1. **Вся логика мастера выполняется локально**, на рабочем месте пользователя.
2. **Никакие данные о личных ключах или сертификатах** не передаются на сторону сервера.
3. Логи мастера:
   - хранятся во временной директории (настройка в приложении);
   - удаляются при нормальном завершении работы мастера;
   - могут быть **явно экспортированы** пользователем в файл отчёта (например, `.txt` или `.html`) для передачи в поддержку.
4. Передача отчёта — всегда осознанное действие пользователя/администратора.

## Аргументы в пользу решения

- **Безопасность и соответствие требованиям ИБ.**
  - Исключается возможность несанкционированной передачи криптографических материалов.
  - Вся чувствительная информация остаётся в периметре организации.

- **Прозрачность.**
  - Пользователь понимает, что отчёт создаётся только по его инициативе.
  - Содержимое отчёта можно стандартизовать (отсутствие секретных данных, только статусы и версии ПО).

- **Проще согласовать внедрение.**
  - Отсутствие сетевого трафика в сторону сторонних сервисов (кроме проверки доступности портала) упрощает согласование с ИБ и сетевыми службами.

## Рассмотренные альтернативы

### Вариант A: Централизованный сбор телеметрии

Мастер автоматически отправляет телеметрию (анонимную или частично анонимную) на сервер для аналитики.

**Плюсы:**
- удобная общая статистика проблем;
- более простая техническая поддержка.

**Минусы:**
- сложные вопросы по ИБ и персональным данным;
- необходимость отдельного сервиса и хранения этих данных;
- высокие требования к прозрачности и уведомлению пользователей.

**Вывод:** отклонено, возможно как отдельный проект с отдельным ADR и участием службы ИБ.

## Последствия

### Положительные

- Минимальный риск утечки чувствительных данных.
- Упрощённая модель угроз и аудита.
- Быстрая интеграция в существующую инфраструктуру (не нужна новая серверная подсистема для логов).

### Отрицательные

- Поддержка лишается централизованной картины по всем инсталляциям мастера.
- Аналитика типовых ошибок возможна только на основании вручную собранных отчётов. 
