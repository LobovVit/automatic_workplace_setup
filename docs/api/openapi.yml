openapi: 3.0.3
info:
  title: EB Master Backend API
  version: 1.0.0
  description: |
    Backend / API для страницы входа в ЛК ГИИС ЭБ и мастера автонастройки рабочего места.

    Основные задачи:
      - выдача статуса подсистем («Авария» / «Работает штатно»);
      - выдача новостей/уведомлений;
      - отдача дистрибутивов мастера автонастройки (Windows / Linux).

servers:
  - url: https://eb.example.ru
    description: Production
  - url: https://eb-test.example.ru
    description: Test / Staging

paths:
  /api/status:
    get:
      summary: Получить статус подсистем
      description: |
        Возвращает агрегированный статус системы и список подсистем с их состоянием.
      operationId: getStatus
      responses:
        '200':
          description: Статус успешно получен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/news:
    get:
      summary: Получить список новостей и уведомлений
      description: |
        Возвращает ленту новостей/уведомлений для пользователей ЛК и мастера настройки.
      operationId: listNews
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Количество записей на странице.
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Смещение для постраничного вывода.
        - in: query
          name: since
          schema:
            type: string
            format: date-time
          description: Вернуть только новости, созданные после указанного момента времени.
      responses:
        '200':
          description: Новости успешно получены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsListResponse'
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/download/master:
    get:
      summary: Скачать мастер автонастройки
      description: |
        Возвращает бинарный файл мастера автонастройки рабочего места
        или перенаправляет на URL скачивания.

        В минимальной реализации может быть просто статический файл,
        но спецификация описывает вариант API-выдачи.
      operationId: downloadMaster
      parameters:
        - in: query
          name: os
          required: true
          schema:
            type: string
            enum: [windows, linux]
          description: |
            Целевая ОС:
              * `windows` — EXE/installer;
              * `linux` — AppImage/скрипт.
      responses:
        '200':
          description: Бинарный файл мастера
          headers:
            Content-Disposition:
              description: Заголовок с именем файла.
              schema:
                type: string
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '400':
          description: Некорректный параметр запроса (например, неизвестная ОС)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    StatusResponse:
      type: object
      description: Агрегированный статус системы и подсистем.
      properties:
        systemStatus:
          type: string
          description: Общий статус системы.
          enum: [OK, DEGRADED, DOWN]
        updatedAt:
          type: string
          format: date-time
          description: Время последнего обновления статуса.
        services:
          type: array
          description: Список подсистем и их статусов.
          items:
            $ref: '#/components/schemas/ServiceStatus'
      required:
        - systemStatus
        - updatedAt
        - services

    ServiceStatus:
      type: object
      description: Статус отдельной подсистемы.
      properties:
        id:
          type: string
          description: Внутренний идентификатор подсистемы (machine-readable).
          example: sobi
        name:
          type: string
          description: Отображаемое имя подсистемы.
          example: Подсистема СОБИ
        status:
          type: string
          description: Статус подсистемы.
          enum: [OK, WARNING, ERROR, UNKNOWN]
        message:
          type: string
          description: Краткое текстовое описание статуса (для пользователя).
          example: Плановое обслуживание до 22:00 (МСК)
        lastCheckedAt:
          type: string
          format: date-time
          description: Время последней проверки подсистемы.
      required:
        - id
        - name
        - status

    NewsListResponse:
      type: object
      description: Ответ со списком новостей.
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/NewsItem'
        total:
          type: integer
          description: Общее количество новостей (для пагинации).
        limit:
          type: integer
        offset:
          type: integer
      required:
        - items
        - total
        - limit
        - offset

    NewsItem:
      type: object
      description: Новость или уведомление.
      properties:
        id:
          type: string
          example: "2025-11-25-eb-outage"
        title:
          type: string
          example: "Плановые работы в ЛК ГИИС ЭБ"
        body:
          type: string
          example: "25 ноября с 21:00 до 22:00 (МСК) возможны кратковременные перерывы в работе ЛК."
        severity:
          type: string
          description: Важность новости.
          enum: [info, warning, critical]
        createdAt:
          type: string
          format: date-time
        validUntil:
          type: string
          format: date-time
          nullable: true
          description: Время, после которого новость можно не отображать (опционально).
      required:
        - id
        - title
        - severity
        - createdAt

    ErrorResponse:
      type: object
      description: Стандартная ошибка API.
      properties:
        code:
          type: string
          example: "BAD_REQUEST"
        message:
          type: string
          example: "Некорректное значение параметра os"
        details:
          type: object
          additionalProperties: true
          description: Дополнительные сведения об ошибке.
      required:
        - code
        - message